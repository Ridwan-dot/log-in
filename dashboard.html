<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fffde7;
    }
    .header {
      display: flex;
      justify-content: space-between;
      background: #ef6c00;
      color: white;
      padding: 15px 20px;
    }
    .post-form {
      padding: 20px;
    }
    input[type="text"] {
      width: 45%;
      padding: 10px;
      margin: 8px 5px;
    }
    button {
      padding: 10px 20px;
      margin: 8px 5px;
      background: #0288d1;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .post {
      margin: 15px 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: white;
    }
  </style>
</head>
<body>
  <div class="header">
    <div id="welcome"></div>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="post-form">
    <input type="text" id="title" placeholder="Enter title" />
    <input type="text" id="desc" placeholder="Enter description" />
    <input type="file" id="filePicker" onchange="pickPicture()"  accept=".png,.jpg,.pdf"/>
    <img src="" alt="" id="image" width="100" height="100"/>
    <button onclick="post()">Post</button>
  </div>

  <div id="posts"></div>

  <script>
    let currentUser = localStorage.getItem("currentUser")

    if (!currentUser) {
      alert("unauthorized user")
      window.location.href = "login.html"
    }

    document.getElementById("welcome").innerHTML = "Welcome " + currentUser.toLowerCase()

    let posts = JSON.parse(localStorage.getItem("posts")) || []

    function post() {
      let title = document.getElementById("title").value.trim()
      let desc = document.getElementById("desc").value.trim()

      if (!title || !desc) {
        alert("All fields are mandatory")
        return
      }

      let existingPost = posts.find((p) => {
        return p.title === title && p.desc === desc && p.image === image.src
      })

      if (existingPost) {
        alert("This post already exists")
        return
      }

      let newPost = {
        title: title,
        desc: desc,
        image: image.src
      }
      posts.push(newPost)
      localStorage.setItem("posts", JSON.stringify(posts))
      displayPosts()
    }

    function pickPicture() {
      let inputFile = document.getElementById("filePicker").files[0]
      let reader = new FileReader()
      if (inputFile) {
        reader.readAsDataURL(inputFile)

      }
      reader.addEventListener("load", (ev) => {
        let result = ev.target.result
        image.src = result
        console.log(result);
        

      })
    }
   

    function displayPosts() {
      let postText = ""

      for (let i = 0; i < posts.length; i++) {
        postText += `
          <div class='post'>
            <strong>Title:</strong> ${posts[i].title}<br>
            <strong>Description:</strong> ${posts[i].desc}
            <img src="${posts[i].image}" width="100" height="100"/>
          </div>
        `
      }

      document.getElementById("posts").innerHTML = postText
    }

    function logout() {
      localStorage.removeItem("currentUser")
      alert("logout successful")
      window.location.href = "login.html"
    }

    displayPosts()
  </script>
</body>
</html>
